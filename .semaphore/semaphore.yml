version: v1.0
name: First pipeline example
agent:
  machine:
    type: e1-standard-8
    os_image: ubuntu1804
    
  containers:
    - name: main
      image: semaphoreci/ruby:2.6.2
    - name: db
      image: postgres:9.6
        
blocks:
  - name: "Test"
    task:
      env_vars:
        - name: APP_ENV
          value: prod
      jobs:
      - name: Test
        commands:
          - whoami
          - pwd
          - ssh-keyscan -H github.com >> ~/.ssh/known_hosts
          - checkout
          - ls -1
          - sudo apt-get install -y postgresql-client
          - psql -c "CREATE USER developer WITH PASSWORD 'developer';" -h db -U postgres
