version: v1.0
name: Hello Docker
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
  containers:
    - name: main
      image: 'semaphoreci/ruby:2.6.1'
      env_vars: []
    - name: db
      image: 'postgres:9.6'
      env_vars:
        - name: POSTGRES_PASSWORD
          value: keyboard-cat
    - name: cache
      image: 'redis:5.0'
      env_vars: []
    - name: myslq
      image: 'mysql:6'
blocks:
  - name: Hello A B C D
    task:
      jobs:
        - name: Hello1
          commands:
            - echo "Hello"
        - name: Hello2
          commands:
            - echo "Hello"
        - name: Hello22
          commands:
            - echo "Hello"
        - name: Hello3
          commands:
            - echo "Hello"
        - name: Hello
          commands:
            - apt-get -y update && apt-get install postgresql-client redis-tools
            - PGPASSWORD="keyboard-cat" createdb -U postgres -h db -p 5432
            - redis-cli -h cache "KEYS *"
    dependencies: []
  - name: 'Block #2'
    task:
      jobs:
        - name: 'Job #1'
          commands: []
    dependencies:
      - Hello A B C D
  - name: 'Block #3'
    task:
      jobs:
        - name: 'Job #1'
          commands: []
    dependencies:
      - 'Block #2'
  - name: 'Block #4'
    task:
      jobs:
        - name: 'Job #1'
          commands: []
    dependencies:
      - 'Block #3'
  - name: 'Block #5'
    task:
      jobs:
        - name: 'Job #1'
          commands: []
    dependencies:
      - 'Block #3'
      - 'Block #4'
